<div class="govuk-grid-row" id="caseProgressComponent">
    <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-m" id="caseHearingsHeading">Case progress</h2>

        <div id="popup-wrapper" class="popup-toggle">
            <div class ="popup-modal">
                <div class ="govuk-!-text-align-left govuk-!-padding-left-3 govuk-!-padding-top-2">
                    <div class="govuk-warning-text govuk-!-margin-bottom-1">
                        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                        <strong class="govuk-warning-text__text">
                            <span class="govuk-warning-text__assistive">Warning</span>
                            There are unsaved notes
                        </strong>
                    </div>
                    <p class="govuk-body-s govuk-!-margin-bottom-9">Save your notes before adding a new one.</p>
                    <button type="button" id="close-btn" class="govuk-button" data-module="govuk-button">Go back</button>
                </div>
            </div>
        </div>

        {% if session.deleteHearingNoteSuccess %}
            {% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
            {% set html %}
                <span class="govuk-body-l">
                        You successfully deleted a note
                    </span>
            {% endset %}
            {{ govukNotificationBanner({
                html: html,
                type: 'success',
                classes: 'case-comments-delete-success-notification'
            }) }}
        {% endif %}
        {% if data.hearings | length %}
                {% if session.showPreviousHearings === data.caseId %}
                    {% set limitPreviousHearings = data.hearings | length %}
                {% else %}
                    {% set limitPreviousHearings = 6 %}
                {% endif %}
                {% for hearing in data.hearings | limit(limitPreviousHearings) %}
                    <div class="app-summary-card govuk-!-margin-bottom-5" id="case-progress-hearing-{{ hearing.hearingId }}">
                        <header class="app-summary-card__header">
                            <div class="app-summary-card__title">
                                <span class="govuk-heading-s govuk-!-margin-bottom-0 govuk-!-display-inline">{{ hearing.hearingTypeLabel }}</span>
                                    {% if features.caseProgressNextAppearanceBadge and hearing.hearingId === data.nextAppearanceHearingId %}
                                        <span class="moj-badge moj-badge--blue pac-badge govuk-!-display-inline govuk-!-margin-left-3">NEXT APPEARANCE</span>
                                    {% endif %}
                                <br/>
                                <span class="govuk-body">
                                    {{ hearing.hearingDateTime | hearingNoteTimeFormat }}, Court {{ hearing.courtRoom }}, {{ hearing.session | lower }} session, {{ hearing.court }}
                                </span>
                            </div>
                        </header>

                        {%- from "components/hearing-notes/macro.njk" import pacHearingNotes -%}
                        {{ pacHearingNotes({
                            data: data,
                            hearing: hearing,
                            currentUserUuid: currentUserUuid
                        }) }}
                    </div>
                {% endfor %}
            <form name="previousCommentsForm" id="caseHearingsForm" method="post" action="summary/hearings/{{ "hideOlderHearings" if session.showPreviousHearings === data.caseId else "showPreviousHearings"}}">

                <input type="hidden" name="caseId" value="{{ data.caseId }}"/>
                {% if data.hearings | length > limitPreviousHearings %}
                    <button type="submit" id="showPreviousHearings" class="govuk-button govuk-button--secondary">Show all previous hearings
                    </button>
                {% endif %}
                {% if session.showPreviousHearings === data.caseId %}
                    <button type="submit" id="showHideOlderHearings" class="govuk-button govuk-button--secondary">Hide older hearings
                    </button>
                {% endif %}
            </form>
        {% endif %}
    </div>
</div>
{% block javascripts %}
    <script type="text/javascript" src="/javascripts/case-progress.js"></script>
{% endblock %}
