{%- set displayDateFormat = 'D MMM YYYY' -%}
{% if user and user.username %}
    {%- set userName = user.username.replace('.', ' ') | properCase -%}
{% endif %}
<!DOCTYPE html>
<html lang="en" class="govuk-template no-js">
<head>

    {% set mainTitle = "Prepare a case for sentence" %}

    {% block head %}
        <meta charset="utf-8"/>

        <title>{{ title }} - {{ mainTitle }}</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
        <meta name="theme-color" content="#0b0c0c"/>

        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

        <link rel="shortcut icon" sizes="16x16 32x32 48x48" href="/assets/images/favicon.ico" type="image/x-icon"/>
        <link rel="mask-icon" href="/assets/images/govuk-mask-icon.svg" color="#0b0c0c">
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/govuk-apple-touch-icon-180x180.png">
        <link rel="apple-touch-icon" sizes="167x167" href="/assets/images/govuk-apple-touch-icon-167x167.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/govuk-apple-touch-icon-152x152.png">
        <link rel="apple-touch-icon" href="/assets/images/govuk-apple-touch-icon.png">

        <link type="text/css" rel="stylesheet" href="/stylesheets/style-{{ appVersion }}.min.css"/>

        <meta property="og:image" content="/assets/images/govuk-opengraph-image.png">

        {% if analyticsCookies === 'accept' %}
          {% if appInsights %}
            <script nonce="{{ nonce }}">
                !function(T,l,y){var S=T.location,k="script",D="instrumentationKey",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);function a(){y.onInit&&y.onInit(n)}(T[t]=n).queue&&0===n.queue.length?(n.queue.push(a),n.trackPageView({})):a()}(window,document,{
                src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js", // The SDK URL Source
                crossOrigin: "anonymous", // When supplied this will add the provided value as the cross origin attribute on the script tag
                cfg: { // Application Insights Configuration
                  instrumentationKey:"{{ instrumentationKey }}",
                  ingestionendpoint: 'https://northeurope-0.in.applicationinsights.azure.com/',
                  liveendpoint: 'https://northeurope.livediagnostics.monitor.azure.com/',
                  autoTrackPageVisitTime: true
                }});

                window.appInsights = appInsights

                appInsights.queue.push(function () {
                  appInsights.addTelemetryInitializer(function (envelope) {
                    envelope.tags["ai.cloud.role"] = "prepare-a-case";
                  })
                })
            </script>
          {% endif %}
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id={{ googleAnalyticsKey }}"></script>
        <script nonce="{{ nonce }}">
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', '{{ googleAnalyticsKey }}');
        </script>
        
        {% endif %}
    {% endblock %}
</head>
<body class="govuk-template__body govuk-frontend-supported">

<a href="#main-content" class="govuk-skip-link">Skip to main content</a>

{% block bodyStart %}
    {% block cookieBanner %}
        {% if not analyticsCookies %}
            {% from "govuk/components/cookie-banner/macro.njk" import govukCookieBanner %}

            {% set html %}
                <p class="govuk-body">We use some essential cookies to make this service work.</p>
                <p class="govuk-body">Weâ€™d also like to use analytics cookies so we can understand how you use the service and make
                    improvements.</p>
            {% endset %}
            <form action="/cookie-preference" method="post">
                {{ govukCookieBanner({
                    ariaLabel: "Cookies on Prepare a case for sentence",
                    messages: [
                        {
                            headingText: "Cookies on Prepare a case for sentence",
                            html: html,
                            actions: [
                            {
                                text: "Accept analytics cookies",
                                type: "submit",
                                name: "cookies",
                                value: "accept"
                            },
                            {
                                text: "Reject analytics cookies",
                                type: "submit",
                                name: "cookies",
                                value: "reject"
                            },
                            {
                                text: "View cookies",
                                href: "/cookies-policy",
                                classes: "govuk-link--no-visited-state"
                            }
                        ]
                        }
                    ]
                }) }}
            </form>
        {% endif %}
    {% endblock %}
{% endblock %}

{% block header %}
    {% include "./header.html" %}
{% endblock %}

{% block phaseBanner %}
  <div class="govuk-width-container">
    {% from "govuk/components/phase-banner/macro.njk" import govukPhaseBanner %}
    {{ govukPhaseBanner({
      tag: {
        text: "Feedback"
      },
      html: '<a class="govuk-link govuk-link--no-visited-state" href="https://docs.google.com/forms/d/e/1FAIpQLScluoDOXsJ_XBO3iOp283JE9mN3vTVNgEJcPNDHQQvU-dbHuA/viewform?usp=sf_link" rel="noreferrer" target="_blank">Give us your feedback</a> or <a class="govuk-link govuk-link--no-visited-state" href="https://docs.google.com/forms/d/e/1FAIpQLSfLqoIFzPIivFNJwCvQPcw6L_fUkbTY6RNqgzrIpN4XGKBqpA/viewform?pli=1" rel="noreferrer" target="_blank">report a bug</a> to help us improve this service.'
    }) }}
  </div>
{% endblock %}

{% block navigation %}
    {%- set currentCourtHtml %}
        <aside>
            <span class="qa-court-name govuk-body govuk-!-font-size-16 govuk-!-font-weight-bold">{{ params.courtName }}</span>
        </aside>
    {% endset -%}
    {%- from "moj/components/primary-navigation/macro.njk" import mojPrimaryNavigation -%}
    
    {% set navItems = [{
        text: 'Cases',
        href: '/' + params.courtCode + '/cases',
        active: title === 'Case list'
    }] %}

    {%- if params.hearingOutcomesEnabled %}
        {% set navItems = (navItems.push({
            text: 'Outcomes',
            href: '/' + params.courtCode + '/outcomes',
            active: title === 'Hearing outcomes'
        }), navItems) %}
    {% endif -%}

    {{ mojPrimaryNavigation({
        label: 'Primary navigation',
        items: navItems,
        searchHtml: currentCourtHtml
    }) }}
{% endblock %}

{% block keydetails %}{% endblock %}

<nav class="govuk-width-container" aria-label="Backwards navigation">
    {% block backlink %}{% endblock %}
</nav>

{% if globalErrors %}
<div class="govuk-width-container" style="margin-top: 7px">
    {% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

    {{ govukErrorSummary({
    titleText: "There is a problem",
    errorList: globalErrors
    }) }}
</div>
{% endif %}

<div class="govuk-width-container">
    <main class="govuk-main-wrapper" id="main-content" role="main">
        {% block content %}{% endblock %}
    </main>


{% block footer %}
    {%- from "govuk/components/footer/macro.njk" import govukFooter -%}
    {{ govukFooter({
        meta: {
            items: [
                {
                    href: "/user-guide",
                    text: "User guide"
                },
                {
                    href: "/accessibility-statement",
                    text: "Accessibility statement"
                },
                {
                    href: "/cookies-policy",
                    text: "Cookies"
                 },
                 {
                    href: "/privacy-notice",
                    text: "Privacy"
                },
                {
                    href: "/whats-new",
                    text: "What's new"
                }
            ]
        }
    }) }}
{% endblock %}

{% block bodyEnd %}

    <script type="module" src="/javascripts/external-{{ appVersion }}.min.js"></script>
    {% if analyticsCookies === 'accept' %}
    <script nonce="{{ nonce }}">
      // Feature detects Navigation Timing API support.
      if (window.performance) {
        // Gets the number of milliseconds since page load
        // (and rounds the result since the value must be an integer).
        var timeSincePageLoad = Math.round(performance.now());
        // Sends the timing event to Google Analytics.
        gtag('event', 'timing_complete', {
          'name': 'load',
          'value': timeSincePageLoad,
          'event_category': 'Performance metrics',
          'event_label': 'Page load time'
        });
      }
    </script>
    {% endif %}
    {% block javascripts %}{% endblock %}

{% endblock %}

</body>
</html>
