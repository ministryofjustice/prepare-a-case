#!/bin/bash

function minifyFile {
  if [[ $1 != *.min.* ]]; then
    MinOut="${1%.*}-${APP_VERSION:-dev-build}.min.${1##*.}"
    echo "Minify: $MinOut"
    minify "$1" > "$MinOut"
  fi
}

for js in "$(pwd)"/public/javascripts/*.js; do
  minifyFile "$js"
done

webpack --env app_version="${APP_VERSION:-dev-build}" --mode production

for css in "$(pwd)"/public/stylesheets/*.css; do
  minifyFile "$css"
done
